---
title: A static blog created with  Node, Markdown, Nunjucks and Eleventy
date: "2019-04-30"
draft: true
description: This site is comprised of static files generated by Eleventy for simplified deployment and hosting. It uses Gulp to automate some build optimisation tasks and to improve performance.
tags:
  - Markdown
  - JAMStack
  - Node

pageClass: "blue-theme"
---

This article details how this blog was put together. If you want to skip this tutorial and get started then fork my [GitHub project.](https://github.com/ptutty/philiptutty.co.uk) - instructions for getting up and running can be found in the Github project readme. Otherwise follow along.

<!--more-->

I'd been meaning to make a switch to a static site generators for my portfolio website for some time and had been casting around for a suitable framework. I'd already created a Node/Express/Nunjucks project with a Gulp build pipeline and Git deployment to Netlify. This [project](https://github.com/ptutty/homegrown-static) was created primarily to speed up the time between local development and having a working prototyping on an external URL for user research and for stakeholder sign-off.

<h2>Eleventy and Markdown to rescue</h2>

As my portfolio site also had a blog I needed a static site generator which ideally had common blog features already baked in and ideally have:

- Flexible configuration options (agnostic about templating engines for instance)
- Javascript based using NPM ecosystem (but not another framework!)
- Use Markdown for content

<blockquote>
  <p>
    There's no need to spend time solving a problem that already been solved.
  </p>
</blockquote>


I eventually stumbled upon [ELEVENTY](https://www.11ty.io/docs/) which had all these things and more, including neat features like the ability to use Markdown front matter to:

- create collections (for post tagging and pagination)

- pass other data such as description, title, classes to use in the template


<h2>Dependancies</h2>

As a given you'll need Node installed on your local machine. You'll also need Yarn which we'll use to install the project dependancies or packages and in our case as a [build tool](https://www.keithcirkel.co.uk/how-to-use-npm-as-a-build-tool/) - we'll still be using Gulp and i'll get to that later. I use brew on macOS to install Yarn

```bash
brew install yarn
```

<blockquote>
  <p>
    You won't need to worry complex dependancies in the final hosting environment one of the strengthes of static site generators is the build process which means we'll only be publishing static html to our web hosting service. In this example I use Netflify(free plan) but you could just as easily use Azure or AWS.
  </p>
</blockquote>



<h3>Clone the repository</h3>



```bash
# Clone the repository
git clone git@github.com:ptutty/philiptutty.co.uk.git your-directory
cd your-directory
# install dependancies
yarn
```

Yarn will look in packages.json and install all the neccessary packages including eleventy, gulp and other packages i'll talk about later.



```json
"dependencies": {
  "@11ty/eleventy": "0.5.4",
  "@11ty/eleventy-plugin-rss": "^1.0.3",
  "@11ty/eleventy-plugin-syntaxhighlight": "^2.0.0",
  "axios": "^0.18.0",
  "dotenv": "^6.1.0",
  "gulp": "^4.0.0",
  "gulp-concat": "^2.6.1",
  "gulp-postcss": "^8.0.0",
  "gulp-sass": "^4.0.1",
  "gulp-uglify": "^3.0.1",
  "html-minifier": "^3.5.20",
  "netlify-lambda": "^1.1.0",
  "twitter": "^1.7.1"
},
"devDependencies": {
  "tailwindcss": "^0.7.4"
}

```

Right now were almost ready to see something. One more command to run from your project directory.

```bash
yarn start
```

This will start a local web server and watch for changes to files in the project directory.

One of the sessions there, given by <a href="https://twitter.com/rozemaryking">Rozemary King</a> talked about the value of play and of being creative. I loved this talk. Rozemary made some wonderful points about how we gradually get our tendancy to play and to discover, trained out of us as we grow up. She talked about the value of exercising our creative muscle without worrying about the judgement of others on how we good that creativity is.



<h2>Build process</h2>

As mentioned earlier we use the NPM scripts to bootstrap things. Yarn start triggers gulp build and watch tasks and also runs eleventy --serve

```bash
"scripts": {
  "start": "gulp build & gulp watch & ELEVENTY_ENV=dev eleventy --serve & yarn run start:functions",
  "prime": "gulp build & ELEVENTY_ENV=prime eleventy",
  "build": "gulp build & ELEVENTY_ENV=dev eleventy && yarn run build:functions",
  "build:functions": "netlify-lambda build src/lambda",
  "dev:functions": "netlify-lambda serve src/lambda"
},
```

You should now be able to view the site locally:

http://localhost:8080/

<blockquote>
  <div>
    In this example i've use the nunjuck templating engine, but you could equally use PUG, Mustache or just vanilla HTML. You'll find the layout in this
  </div>
</blockquote>

You can locate the template files in this folder:

![coventry half marathon](/images/template-location-eleventy.png)

I've used [TailwindCSS](https://tailwindcss.com/docs/what-is-tailwind/) in this project which is an Atomic 'utility first' CSS framework, but you could equally use SASS or LESS. TailwindsCSS uses PostCSS in the GULP build pipline:

```javascript
gulp.task('css', function () {
  return gulp.src('src/css/styles.css')
    .pipe(postcss([
      tailwindcss('./src/css/tailwind.js'),
      require('autoprefixer'),
    ]))

    .pipe(gulp.dest('./src/site/css'));
});

```


<h2>Creating blog posts</h2>

The process of creating a new post is easy. I use Atom as my IDE and a package called Markdown writer which i can configure to populate a new markdown file with some basic front matter.

![mark down generator in ATOM](/images/mark-down-generator.png);


Below: Markdown front matter.

``` html
---
title: "my-first-blog-post.md"
description: Setting up front matter on MarkDown.
date: "2019-04-30"
allowcomments: true
tags: ["NPM", "ATOM", "Markdown"]
photoCredits:
  - name: "Sandro Kradolfer"
    url: "https://unsplash.com/photos/IVYZWptFt1g"
pageClass: "blue-theme"
---

```

Everything is written in standard Markdown. When the file is saved templates, CSS, images, and Marksdown are 'built' and moved to the 'dist' directory. You can see changes on the local server straightaway.

<h2>Deployment</h2>

[Netflify](https://www.netlify.com/) is a Cloud web hosting service service with an all-in-one workflow that combines global deployment, continuous integration, and automatic HTTPS. Best of all you can use their free tier to host simple static websites like ours.

Use git to stage and push your project to a gitHub repository you have created. Next create a Netflify account and connect it to you github account and tell it which branch you would like to deploy. Once this is done your project will be deployed to Netflify each time you push to your git remote.


<blockquote>
  <div>
    With Netflify you can add your own domain and get SSL encryption for free!  You can also deploy multiple git branches and view them on different sub domains  - ideal for split testing.
  </div>
</blockquote>



<h3>Lambda functions</h3>

Okay, static website have alot of benefits: security, page load times, uptime, benefits of CDN, scalability, no need for memory hogging databases. But what if you need some dynamic elements such as comments or just a simple html contact form? This is where [Lamda function](https://www.netlify.com/docs/functions/) come in. AWS Lambda functions open a world of possibilities for running on-demand, server-side code without having to run a dedicated server. Netflify make the process of using AWS function a little easier.

In the basic example below we grab, the query string parameters


```javascript
export function handler(event, context, callback) {

  // grab the parameters from the request
  const params = event.queryStringParameters;

  // Report back to our logs
  console.log(`You called the Lambda function with all of these parameters: ${JSON.stringify(params)}`);

  // send a response
  return callback(null, {
    statusCode: 200,
    body: `Hello from the serverless function. Called with these parameters: ${JSON.stringify(params)}`
  });

};

```
That said Netflify has some build in feature for handling simple form data and adding notification and integration with services like Slack.
